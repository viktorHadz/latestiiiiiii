<div x-data="editView" class="border rounded border-vls/40 p-2 shadow ml-2 h-full bg-vlp dark:bg-vdp2">
  <!-- When no invoice selected -->
  <template x-if="!$store.edit.showInvoiceItems">
    <div class="flex items-center justify-center h-full text-center text-vls3 dark:text-vds">
      <p class="text-xl">Pick an invoice from the list to view details.</p>
    </div>
  </template>

  <!-- Invoice Details Display (Read-Only) -->
  <template x-if="$store.edit.showInvoiceItems && !$store.edit.editing && !$store.edit.openEditModal">
    <div class="overflow-y-auto h-full p-2 text-vls2 dark:text-vds table-scrollbar">
      <div>
        <div
          class="mb-2 flex justify-between items-center rounded bg-vls2 text-vlp dark:bg-vdp border border-vls/40 shadow p-2 font-medium">
          <div>
            <span class="mr-1">Invoice:</span>
            <span x-text="$store.edit.invoiceItems.invoice.invoice_number"></span>
          </div>
          <div>
            <span class="ml-4 mr-1">Date:</span>
            <span x-text="$store.edit.invoiceItems.invoice.date"></span>
          </div>
        </div>
        <!-- Client Details -->
        <div class="mb-2 flex flex-col justify-between rounded bg-vlp shadow dark:bg-vdp2 border border-vls/40 p-2">
          <div class="flex justify-between">
            <p>Client name:</p>
            <span x-text="$store.clients.selectedClient?.name"></span>
          </div>
          <div class="flex justify-between">
            <p>Company:</p>
            <span x-text="$store.clients.selectedClient?.company_name"></span>
          </div>
          <div class="flex justify-between">
            <p>Address:</p>
            <span x-text="$store.clients.selectedClient?.address"></span>
          </div>
          <div class="flex justify-between">
            <p>Email:</p>
            <span x-text="$store.clients.selectedClient?.email"></span>
          </div>
          <div class="flex justify-between">
            <p>Created on:</p>
            <span x-text="$store.edit.invoiceItems.invoice.date"></span>
          </div>
          <div class="flex justify-between">
            <p>Due-by-date:</p>
            <span x-text="$store.edit.invoiceItems.invoice.due_by_date"></span>
          </div>
        </div>
        <!-- Invoice Items Table -->
        <div class="relative p-2 border rounded border-vls/40">
          <div><p class="text-red-500">search bar</p></div>
          <div class="relative py-0 overflow-y-auto table-scrollbar" style="max-height: 30vh">
            <table class="w-[calc(100%-10px)] table-auto border-separate px-0.5" style="border-spacing: 0 10px">
              <thead class="sticky top-0 table-head-style border-clipper">
                <tr>
                  <th class="border text-left border-transparent round-left-border p-2 text-base w-[50%]">Name</th>
                  <th class="p-2 text-left w-[15%]">Type</th>
                  <th class="p-2 text-right w-[15%]">Qty</th>
                  <th class="p-2 text-right w-[20%] round-right-border">Price</th>
                </tr>
              </thead>

              <tbody class="table-body-style table-scrollbar">
                <template x-for="item in $store.edit.invoiceItems.invoiceItems" :key="item.frontendId">
                  <tr class="border-hover-ring-efect">
                    <td class="p-2 truncate round-left-border text-sm" x-text="item.name" style="width: 50%"></td>
                    <td class="p-2 text-sm" x-text="item.type" style="width: 15"></td>
                    <td class="p-2 text-right text-sm" x-text="item.quantity" style="width: 15%"></td>
                    <td
                      class="p-2 text-right round-right-border text-sm"
                      x-text="'£' + item.price"
                      style="width: 20%"></td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Invoice Summary & Action Buttons -->
        <div class="flex my-2">
          <div
            class="text-sm flex flex-col w-[30%] p-4 gap-4 mr-2 bg-vlp rounded border-vls/60 border text-vls3 dark:bg-vdp dark:text-vds dark:border-vls/40 shadow-md dark:shadow">
            <h2 class="font-semibold text-base">Invoice Summary</h2>
            <div class="flex justify-between">
              <span>Subtotal:</span>
              <span x-text="'£' + $store.edit.invoiceItems.invoice.subtotal_pre_discount"></span>
            </div>
            <template x-if="$store.edit.invoiceItems.invoice.discount_value > 0">
              <div class="flex justify-between">
                <span>Discount:</span>
                <div>
                  <span
                    x-text="$store.edit.invoiceItems.invoice.discount_type === 1
                    ? ($store.edit.invoiceItems.invoice.discount_value + '%')
                    : ('£' + $store.edit.invoiceItems.invoice.discount_value)"></span>
                  <span
                    x-show="$store.edit.invoiceItems.invoice.discount_type === 1"
                    x-text="`(£${$store.edit.invoiceItems.invoice.discVal_ifPercent})`"></span>
                </div>
              </div>
            </template>
            <div class="flex justify-between">
              <span>VAT:</span>
              <span x-text="'£' + $store.edit.invoiceItems.invoice.vat"></span>
            </div>
            <div class="flex justify-between">
              <span>Total:</span>
              <span class="font-semibold" x-text="'£' + $store.edit.invoiceItems.invoice.total"></span>
            </div>
            <template x-if="$store.edit.invoiceItems.invoice.deposit_value > 0">
              <div class="flex justify-between">
                <span>Deposit:</span>
                <div>
                  <span
                    x-text="$store.edit.invoiceItems.invoice.deposit_type === 1 ? ($store.edit.invoiceItems.invoice.deposit_value + '%') : ('£' + $store.edit.invoiceItems.invoice.deposit_value)"></span>
                  <span
                    x-show="$store.edit.invoiceItems.invoice.deposit_type === 1"
                    x-text="`(£${$store.edit.invoiceItems.invoice.depoVal_ifPercent})`"></span>
                </div>
              </div>
            </template>
            <div class="flex justify-between font-semibold">
              <span>Remaining:</span>
              <span x-text="'£' + ($store.edit.invoiceItems.invoice.remaining)"></span>
            </div>
          </div>
          <div
            class="flex w-[70%] p-4 items-end justify-around bg-vlp rounded border-vls/60 border text-vls3 dark:bg-vdp dark:text-vds dark:border-vls/40 shadow-md dark:shadow">
            <div class="flex justify-around w-full">
              <button
                @click="$store.edit.deleteInvoice($store.edit.invoiceItems.invoice.id)"
                class="modal-btn-sec flex items-center">
                <svg class="size-4 mr-1">
                  <use href="/icons/icons.svg#trash" />
                </svg>
                Delete
              </button>
              <!-- Button to open full parent edit modal -->
              <button @click="$store.edit.openParentEditModal()" class="modal-btn-prim">
                <svg class="size-4 mr-1">
                  <use href="/icons/icons.svg#editor" />
                </svg>
                Edit
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </template>
  <!-- Edit Invoice Modal -->
  <div id="modal-edit"></div>

  <!-- Copy Invoice Editor -->
  <div id="copy-editor"></div>
</div>
