<div x-data="editView" class="border border-vls/40 h-full ml-2 rounded p-2 shadow">
  <!-- When no invoice is selected or none is being edited -->
  <template x-if="!$store.edit.showInvoiceItems">
    <div
      x-ref="tempText"
      class="flex h-full w-full items-center justify-center text-center align-middle text-vls3 dark:text-vds">
      <p class="text-xl">Pick an invoice from the list to edit.</p>
    </div>
  </template>

  <!-- NON-EDIT Mode Display -->
  <template x-if="$store.edit.showInvoiceItems && !$store.edit.editing">
    <div class="alt-table-scrollbar max-h-[100%] w-full overflow-y-auto text-vls2 dark:text-vds">
      <div
        class="mb-2 flex w-full justify-between rounded bg-vlp border border-vls/40 shadow p-2 text-center text-vls2 dark:text-vds font-medium dark:bg-vdp">
        <div>
          <span class="mr-1">Invoice:</span>
          <span x-text="$store.edit.invoiceItems.invoice?.invoice_number"></span>
        </div>
        <div>
          <span class="ml-4 mr-1">Date:</span>
          <span x-text="$store.edit.invoiceItems.invoice?.date"></span>
        </div>
      </div>
      <!-- Client Details -->
      <div class="mb-2 flex w-full justify-between rounded border bg-vlp shadow dark:bg-vdp2 border-vls/40 p-2">
        <div class="w-full">
          <div class="flex justify-between w-full">
            <p>Client name:</p>
            <span x-text="$store.clients.selectedClient?.name"></span>
          </div>
          <div class="flex justify-between w-full">
            <p>Company:</p>
            <span x-text="$store.clients.selectedClient?.company_name"></span>
          </div>
          <div class="flex justify-between w-full">
            <p>Address:</p>
            <span x-text="$store.clients.selectedClient?.address"></span>
          </div>
          <div class="flex justify-between w-full">
            <p>Email:</p>
            <span x-text="$store.clients.selectedClient?.email"></span>
          </div>
        </div>
      </div>
      <!-- Invoice Items Table -->
      <div class="alt-table-scrollbar mb-2 w-full border rounded border-vls/40 p-1 bg-vlp dark:bg-vdp2">
        <!-- Fixed Table Header -->
        <table class="w-full table-auto border-separate px-0.5" style="border-spacing: 0 10px; table-layout: fixed">
          <thead class="sticky top-0 table-head-style border-clipper bg-vlp dark:bg-vdp z-10">
            <tr>
              <th class="p-2 text-start px-2 round-left-border w-[50%]">Name</th>
              <th class="p-2 w-[15%] text-left">Type</th>
              <th class="p-2 text-right w-[15%]">Qty</th>
              <th class="p-2 round-right-border text-right w-[20%]">Price</th>
            </tr>
          </thead>
        </table>

        <!-- Scrollable Table Body -->
        <div class="max-h-[40vh] overflow-y-auto">
          <table class="w-full table-auto border-separate px-0.5" style="border-spacing: 0 10px; table-layout: fixed">
            <tbody class="table-body-style table-scrollbar">
              <template
                x-for="item in $store.edit.invoiceItems.invoiceItems"
                :key="`non-edit-${item.type}-${item.origin_id !== null ? item.origin_id : `custom-${item.type}-${$store.edit.getCustomIndex(item)}`}`">
                <tr class="border-hover-ring-efect">
                  <td class="round-left-border px-2 py-1 text-sm w-[50%]" x-text="item.name"></td>
                  <td class="px-2 py-1 w-[15%]" x-text="item.type"></td>
                  <td class="px-2 py-1 text-sm text-right w-[15%]" x-text="item.quantity"></td>
                  <td class="round-right-border px-4 py-1 text-right text-sm w-[20%]" x-text="'£' + item.price"></td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>

      <div class="flex">
        <!-- Prices -->
        <div
          class="text-sm flex flex-col w-[30%] p-4 gap-4 mr-2 bg-vlp rounded border-vls/40 border text-vls3 dark:bg-vdp dark:text-vds dark:border-vls/40 shadow dark:shadow">
          <h2 class="font-semibold text-base leading-tight text-vls2/90 dark:text-vds3light">Invoice Summary</h2>
          <!-- Subtotal -->
          <h3 class="flex justify-between">
            <span class="text-vls2/80 dark:text-vds/60">Subtotal:</span>
            <span
              class="text-opacity-90 dark:text-vds opacity-90"
              x-text="'£' + $store.edit.invoiceItems.invoice.subtotal_pre_discount"></span>
          </h3>

          <!-- Discount -->
          <template x-if="$store.edit.invoiceItems.invoice.discount_value > 0">
            <div class="flex justify-between">
              <h3 class="text-vls2/80 dark:text-vds/60">Discount:</h3>
              <div class="flex items-center">
                <span
                  class="text-opacity-90 text-vls2 dark:text-vds"
                  x-text="$store.edit.invoiceItems.invoice.discount_type === 1 
            ? $store.edit.invoiceItems.invoice.discount_value + '%' 
            : '£' + $store.edit.invoiceItems.invoice.discount_value"></span>

                <div
                  x-show="$store.edit.invoiceItems.invoice.discount_type === 1"
                  class="text-xs text-vls2/60 dark:text-vds3light">
                  <p x-text="'(' + '£' + $store.edit.invoiceItems.invoice.discVal_ifPercent + ')'"></p>
                </div>
              </div>
            </div>
          </template>

          <!-- VAT -->
          <h3 class="flex justify-between">
            <span class="text-vls2/80 dark:text-vds/60">VAT:</span>
            <span
              class="text-opacity-90 text-vls3 dark:text-vds opacity-90"
              x-text="'£' + $store.edit.invoiceItems.invoice.vat"></span>
          </h3>

          <!-- Total -->
          <h3 class="flex justify-between">
            <span class="text-vls2/80 dark:text-vds/60">Total:</span>
            <span class="font-semibold opacity-95" x-text="'£' + $store.edit.invoiceItems.invoice.total"></span>
          </h3>

          <!-- Deposit -->
          <template x-if="$store.edit.invoiceItems.invoice.deposit_value > 0">
            <div class="flex justify-between">
              <h3 class="text-vls2/80 dark:text-vds/60">Deposit:</h3>
              <div class="flex items-center">
                <span
                  class="text-opacity-90 text-vls2 dark:text-vds"
                  x-text="$store.edit.invoiceItems.invoice.deposit_type === 1 
            ? $store.edit.invoiceItems.invoice.deposit_value + '%' 
            : '£' + $store.edit.invoiceItems.invoice.deposit_value"></span>

                <div
                  x-show="$store.edit.invoiceItems.invoice.deposit_type === 1"
                  class="text-xs text-vls2/60 dark:text-vds3light">
                  <p x-text="'(' + '£' + $store.edit.invoiceItems.invoice.depoVal_ifPercent + ')'"></p>
                </div>
              </div>
            </div>
          </template>
        </div>

        <!-- EDIT DISCOUNT DEPOSIT NOTE PDF-->

        <div
          class="flex flex-col w-[70%] p-4 items-end justify-end bg-vlp rounded border-vls/40 border text-vls3 dark:bg-vdp dark:text-vds dark:border-vls/40 shadow">
          <div
            class="w-full border border-vls/40 text-vls3 dark:text-vds rounded p-4 mb-4 flex-grow overflow-y-auto bg-white dark:bg-vdp shadow">
            <p x-text="'Note: ' + $store.edit.invoiceItems.invoice?.note" class="text-xs break-words"></p>
          </div>
          <div class="flex gap-4 justify-end">
            <button
              x-show="$store.edit.edited"
              @click="$store.pdfStore.generateInvoice()"
              class="modal-btn-sec flex items-center">
              <svg class="size-4 mr-1">
                <use href="/icons/icons.svg#download-document" />
              </svg>
              PDF
            </button>
            <!-- Non-editable button  -->
            <template x-if="$store.edit.copyInvoices[$store.edit.invoiceItems.invoice.id]?.length > 0">
              <div x-data="tooltip('Cannot edit invoice. Can only edit invoices without copies.')">
                <button
                  @click.stop="callWarning('Cannot edit this invoice.', 'Can only edit invoices without copies.')"
                  class="!text-gray-400 cursor-not-allowed flex items-center modal-btn-prim">
                  <svg class="size-4">
                    <use href="/icons/icons.svg#editor" />
                  </svg>
                  Edit Invoice
                </button>
              </div>
            </template>

            <!-- Editable button (no copied children invoices) -->
            <template x-if="!$store.edit.copyInvoices[$store.edit.invoiceItems.invoice.id]?.length">
              <div>
                <button @click="$store.edit.openEditModal = true" class="modal-btn-prim flex">
                  <svg class="size-4">
                    <use href="/icons/icons.svg#editor" />
                  </svg>
                  Edit Invoice
                </button>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </template>

  <!-- Edit Mode (overwrite or copy) -->
  <template x-if="$store.edit.editing">
    <div class="alt-table-scrollbar max-h-[100%] overflow-auto w-full text-vls2 dark:text-vds">
      <!-- Header / Basic Info in Edit Mode -->
      <div
        class="mb-2 rounded bg-vlp border border-vls/40 shadow p-2 text-center text-vls2 dark:text-vds font-medium dark:bg-vdp">
        <div class="flex w-full justify-between">
          <div>
            <span class="mr-1">Invoice:</span>
            <span x-text="$store.edit.invoiceItems.invoice?.invoice_number"></span>
          </div>
          <div>
            <span class="ml-4 mr-1">Date:</span>
            <span x-text="$store.edit.invoiceItems.invoice?.date"></span>
          </div>
          <span class="ml-4">
            Edit Mode:
            <span x-show="$store.edit.editMode === 'editOverwrite'" class="font-semibold">Overwrite</span>
            <span x-show="$store.edit.editMode === 'editCopy'" class="font-semibold">Copy</span>
          </span>
        </div>
      </div>

      <!-- Editable Invoice Items -->
      <div class="mb-2 flex w-full justify-between rounded border border-vls/40 bg-vlp shadow dark:bg-vdp2 p-2">
        <!-- Client info -->
        <div class="w-full">
          <div class="flex justify-between w-full">
            <p>Client name:</p>
            <span x-text="$store.clients.selectedClient?.name"></span>
          </div>
          <div class="flex justify-between w-full">
            <p>Company:</p>
            <span x-text="$store.clients.selectedClient?.company_name"></span>
          </div>
          <div class="flex justify-between w-full">
            <p>Address:</p>
            <span x-text="$store.clients.selectedClient?.address"></span>
          </div>
          <div class="flex justify-between w-full">
            <p>Email:</p>
            <span x-text="$store.clients.selectedClient?.email"></span>
          </div>
        </div>
      </div>

      <!-- Items Table -->
      <div class="alt-table-scrollbar mb-2 w-full border rounded border-vls/40 bg-vlp shadow p-1 dark:bg-vdp2">
        <table class="w-full table-auto border-separate px-0.5" style="border-spacing: 0 10px; table-layout: fixed">
          <!-- Sticky header -->
          <thead class="sticky top-0 table-head-style border-clipper bg-vlp dark:bg-vdp z-10">
            <tr>
              <th class="p-2 round-left-border text-left w-[45%]">Name</th>
              <th class="p-2 text-left w-[10%]">Type</th>
              <th class="p-2 text-right w-[10%]">Qty</th>
              <th class="p-2 text-right w-[10%]">Price</th>
              <template x-if="$store.edit.editMode === 'editOverwrite'">
                <th class="py-2 round-right-border w-[15%]">Actions</th>
              </template>
            </tr>
          </thead>
        </table>

        <!-- Scrollable Table Body Wrapper -->
        <div class="max-h-[35vh] overflow-y-auto">
          <table class="w-full table-auto border-separate px-0.5" style="border-spacing: 0 10px; table-layout: fixed">
            <tbody class="table-body-style table-scrollbar !text-sm">
              <template x-for="item in $store.edit.invoiceItems.invoiceItems" :key="item.frontendId">
                <tr class="border-hover-ring-efect">
                  <td
                    class="p-1 w-[45%] text-left round-left-border truncate overflow-hidden whitespace-nowrap"
                    x-text="item.name"></td>
                  <td class="p-1 w-[10%] text-left" x-text="item.type"></td>
                  <td class="p-1 w-[10%] text-right" x-text="item.quantity"></td>
                  <td class="p-1 w-[10%] text-right" x-text="'£' + item.price"></td>
                  <template x-if="$store.edit.editMode === 'editOverwrite'">
                    <td class="p-1 w-[15%] text-right round-right-border">
                      <div class="flex justify-end gap-1">
                        <!-- Increment -->
                        <button
                          @click="$store.edit.incrementInvoiceItem(item.frontendId)"
                          class="table-interaction-icon-blue">
                          <svg class="size-5">
                            <use href="/icons/icons.svg#plus-circle" />
                          </svg>
                        </button>
                        <!-- Decrement -->
                        <button
                          @click="$store.edit.decrementInvoiceItem(item.frontendId)"
                          class="table-interaction-icon-red">
                          <svg class="size-5">
                            <use href="/icons/icons.svg#minus-circle" />
                          </svg>
                        </button>
                        <!-- Remove -->
                        <button
                          @click="$store.edit.removeInvoiceItem(item.frontendId)"
                          class="table-interaction-icon-red">
                          <svg class="size-5">
                            <use href="/icons/icons.svg#trash" />
                          </svg>
                        </button>
                      </div>
                    </td>
                  </template>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>
      <!-- Editable Prices -->
      <div class="flex">
        <div
          class="text-sm flex flex-col w-[30%] p-4 gap-4 mr-2 bg-vlp rounded border-vls/40 border text-vls3 dark:bg-vdp dark:text-vds dark:border-vls/40 shadow">
          <h2 class="font-semibold text-base leading-tight text-vls2/90 dark:text-vds3light">Invoice Summary</h2>

          <!-- Subtotal -->
          <h3 class="flex justify-between">
            <span class="text-vls2 dark:text-vds/60">Subtotal:</span>
            <div>
              <span
                class="text-opacity-90 dark:text-vds opacity-90"
                x-text="'£' + $store.edit.invoiceItems.invoice.subtotal_pre_discount"></span>
              <template x-if="$store.edit.invoiceItems.invoice.discount_value > 0">
                <span
                  class="text-xs text-vls2/60 dark:text-vds3light"
                  x-text="'(£' + $store.edit.invoiceItems.invoice.subtotal + ')'"></span>
              </template>
            </div>
          </h3>

          <!-- Discount -->
          <template x-if="$store.edit.invoiceItems.invoice.discount_value > 0">
            <div class="flex justify-between">
              <h3 class="text-vls2/80 dark:text-vds/60">Discount:</h3>
              <div class="flex items-center">
                <span
                  class="text-opacity-90 text-vls2 dark:text-vds"
                  x-text="$store.edit.invoiceItems.invoice.discount_type === 1 
            ? $store.edit.invoiceItems.invoice.discount_value + '%' 
            : '£' + $store.edit.invoiceItems.invoice.discount_value"></span>

                <div
                  x-show="$store.edit.invoiceItems.invoice.discount_type === 1"
                  class="text-xs text-vls2/60 dark:text-vds3light">
                  <p x-text="'(' + '£' + $store.edit.invoiceItems.invoice.discVal_ifPercent + ')'"></p>
                </div>
                <button
                  x-show="$store.edit.invoiceItems.invoice.discount_value"
                  @click="$store.edit.removeDiscount()"
                  class="ml-2 text-red-500 hover:text-red-600">
                  <svg class="size-4">
                    <use href="/icons/icons.svg#trash"></use>
                  </svg>
                </button>
              </div>
            </div>
          </template>

          <!-- VAT -->
          <h3 class="flex justify-between">
            <span class="text-vls2/80 dark:text-vds/60">VAT:</span>
            <span
              class="text-opacity-90 text-vls3 dark:text-vds opacity-90"
              x-text="'£' + $store.edit.invoiceItems.invoice.vat"></span>
          </h3>

          <!-- Total -->
          <h3 class="flex justify-between">
            <span class="text-vls2/80 dark:text-vds/60">Total:</span>
            <span class="font-semibold opacity-95" x-text="'£' + $store.edit.invoiceItems.invoice.total"></span>
          </h3>

          <!-- Deposit -->
          <template x-if="$store.edit.invoiceItems.invoice.deposit_value > 0">
            <div class="flex justify-between">
              <h3 class="text-vls2/80 dark:text-vds/60">Deposit:</h3>
              <div class="flex items-center">
                <span
                  class="text-opacity-90 text-vls2 dark:text-vds"
                  x-text="$store.edit.invoiceItems.invoice.deposit_type === 1 
            ? $store.price.roundToTwo($store.edit.invoiceItems.invoice.deposit_value) + '%' 
            : '£' + $store.price.roundToTwo($store.edit.invoiceItems.invoice.deposit_value)"></span>

                <div
                  x-show="$store.edit.invoiceItems.invoice.deposit_type === 1"
                  class="text-xs text-vls2/60 dark:text-vds3light">
                  <p
                    x-text="'(' + '£' + $store.price.roundToTwo($store.edit.invoiceItems.invoice.depoVal_ifPercent) + ')'"></p>
                </div>

                <button
                  x-show="$store.edit.invoiceItems.invoice.deposit_value"
                  @click="$store.edit.removeDeposit()"
                  class="ml-2 text-red-500 hover:text-red-600">
                  <svg width="16" height="16">
                    <use href="/icons/icons.svg#trash"></use>
                  </svg>
                </button>
              </div>
            </div>
          </template>
        </div>
        <div
          class="flex flex-col w-[70%] px-6 py-2 items-end gap-2 justify-between bg-vlp rounded border-vls/40 border text-vls3 dark:bg-vdp dark:text-vds dark:border-vls/40 shadow">
          <!-- NOTE -->
          <template x-if="$store.edit.editMode === 'editOverwrite'">
            <div
              class="w-full h-full border border-vls/40 text-vls3 dark:text-vds rounded p-2 flex flex-col justify-between max-h-[50vh] overflow-y-auto bg-white dark:bg-vdp">
              <div class="flex justify-between">
                <div>
                  <p x-text="'Note: ' + $store.edit.invoiceItems.invoice?.note" class="text-xs break-words"></p>
                </div>
              </div>
              <button
                x-show="$store.edit.invoiceItems.invoice.note.length !== 0"
                @click="$store.edit.invoiceItems.invoice.note = ''"
                class="self-start justify-self-start flex mt-0.5 text-xs text-red-600 hover:underline">
                Remove Note
              </button>
            </div>
          </template>
          <template x-if="$store.edit.editMode === 'editCopy'">
            <div
              class="w-full h-full text-vls3 dark:text-vds rounded p-2 flex flex-col justify-between overflow-y-auto bg-white dark:bg-vdp relative">
              <!-- Info Icon (Tooltip) -->
              <div
                x-data="tooltip(`Use this screen to create a copy of your current invoice.\nThis allows you to invoice clients for any paid deposits they\n may have balanced towards the original amount due.
                E.g. SAM-${$store.edit.invoiceItems.invoice.invoice_number} → SAM-${$store.edit.invoiceItems.invoice.invoice_number}.1
                Supports multiple copies (e.g., SAM-X.1, SAM-X.2, etc.)`)"
                class="absolute top-1 right-1">
                <div class="relative">
                  <button class="cursor-default">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                      class="size-5">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" />
                    </svg>
                  </button>
                </div>
              </div>

              <h2 class="text-sm font-semibold text-center mb-2 text-vls2/90 dark:text-vds3light">
                Follow-up Invoice for
                <span x-text="$store.edit.invoiceItems.invoice.invoice_number" class="text-xs"></span>
              </h2>

              <!-- Totals (Always Visible) -->
              <div class="mt-4 border-t border-vls/40 pt-2 text-sm">
                <h3 class="font-semibold text-center mb-2">Totals After Invoice Payment</h3>

                <div class="flex justify-between">
                  <template x-if="$store.edit.invoiceItems.invoice.discount_value === 0">
                    <span>Subtotal:</span>
                    <span x-text="'£' + ($store.edit.invoiceItems.invoice.subtotal)"></span>
                  </template>
                  <template x-if="$store.edit.invoiceItems.invoice.discount_value > 0">
                    <span>Discounted Subtotal:</span>
                  </template>
                  <span x-text="'£' + ($store.edit.invoiceItems.invoice.subtotal)"></span>
                </div>

                <div class="flex justify-between">
                  <span>VAT:</span>
                  <span x-text="'£' + $store.edit.invoiceItems.invoice.vat"></span>
                </div>
                <div class="flex justify-between">
                  <span>Total:</span>
                  <span x-text="'£' + ($store.edit.invoiceItems.invoice.total)"></span>
                </div>
                <!-- Deposit -->
                <template x-if="$store.edit.invoiceItems.invoice.deposit_value > 0">
                  <div class="flex justify-between">
                    <h3 class="text-vls2 dark:text-vds">Deposit:</h3>
                    <div class="flex items-center">
                      <span
                        class="text-opacity-90 text-vls2 dark:text-vds"
                        x-text="$store.edit.invoiceItems.invoice.deposit_type === 1 
            ? $store.price.roundToTwo($store.edit.invoiceItems.invoice.deposit_value) + '%' 
            : '£' + $store.price.roundToTwo($store.edit.invoiceItems.invoice.deposit_value)"></span>

                      <div
                        x-show="$store.edit.invoiceItems.invoice.deposit_type === 1"
                        class="text-xs text-vls2/60 dark:text-vds3light">
                        <p
                          x-text="'(' + '£' + $store.price.roundToTwo($store.edit.invoiceItems.invoice.depoVal_ifPercent) + ')'"></p>
                      </div>
                    </div>
                  </div>
                </template>
                <div class="flex justify-between font-semibold">
                  <span>Remaining Balance:</span>
                  <div class="flex items-center">
                    <span
                      class="text-opacity-90 text-vls2 dark:text-vds"
                      x-text="
                        $store.edit.invoiceItems.invoice.deposit_type === 1
                          ? '£' + (
                            $store.price.roundToTwo( $store.edit.invoiceItems.invoice.total -
                              $store.edit.invoiceItems.invoice.depoVal_ifPercent
                            ))
                          : '£' + (
                              $store.price.roundToTwo($store.edit.invoiceItems.invoice.total -
                              $store.edit.invoiceItems.invoice.deposit_value)
                            )
                      "></span>
                    <div
                      x-show="$store.edit.invoiceItems.invoice.deposit_type === 1"
                      class="text-xs text-vls2/60 dark:text-vds3light ml-1">
                      <p
                        x-text="'(' + $store.price.roundToTwo($store.edit.invoiceItems.invoice.deposit_value) + '%)'"></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </template>

          <div class="flex justify-between w-full">
            <!-- Add Discount Modal -->
            <div>
              <button
                @click="$store.edit.modDisc = !$store.edit.modDisc"
                x-ref="discountAnchor"
                class="modal-btn-prim !text-xs">
                <svg class="size-4">
                  <use href="/icons/icons.svg#trending-down"></use>
                </svg>
                Discount
              </button>
              <div
                x-show="$store.edit.modDisc; $nextTick(() => { $refs.discountInput.focus() });"
                @keyup.escape="$store.edit.modDisc = false"
                @mouseenter="$store.edit.showXDisc = true"
                @mouseleave="$store.edit.showXDisc = false"
                x-transition.duration.300
                x-anchor.top.offset.10="$refs.discountAnchor"
                class="ml-2">
                <div class="z-10 p-4 bg-white border-vls/40 border dark:bg-vdp2 text-vls3 rounded shadow-lg max-w-48">
                  <div class="relative">
                    <button
                      x-show="$store.edit.showXDisc"
                      @click="$store.edit.modDisc = false"
                      x-transition.duration.300
                      class="absolute !-top-3 !-right-3 table-interaction-icon-red">
                      <svg class="size-4">
                        <use href="/icons/icons.svg#xmark-circle"></use>
                      </svg>
                    </button>
                  </div>
                  <h3 class="mb-2 modal-title !text-lg !text-center">Discount</h3>
                  <div class="relative mb-3">
                    <input
                      :id="'discount-input-edit'"
                      x-ref="discountInput"
                      type="number"
                      x-model.number="$store.edit.uiDiscount"
                      placeholder="0"
                      @input="$store.edit.uiDiscount = parseFloat(String($store.edit.uiDiscount).slice(0, 6)) || 0"
                      class="modal-input-style !p-1 max-w-36 flex place-self-center" />
                    <span
                      class="absolute right-4 top-1/2 transform -translate-y-1/2 text-base text-vls2/70 dark:text-vds/70">
                      <!-- Dynamically show the symbol -->
                      <span x-text="$store.edit.invoiceItems.invoice.discount_type === 1 ? '%' : '£'"></span>
                    </span>
                  </div>
                  <div class="flex justify-between gap-x-4">
                    <button
                      @click="$store.edit.addDiscount(); $nextTick(() => { $refs.discountInput.focus() });"
                      class="modal-btn-prim !place-self-center !text-xs">
                      <svg class="size-4">
                        <use href="/icons/icons.svg#check-circle"></use>
                      </svg>
                      Apply
                    </button>
                    <button
                      @click="$store.edit.changeDiscountType(); $nextTick(() => { $refs.discountInput.focus() });"
                      class="modal-btn-prim !place-self-center !text-xs">
                      <svg class="size-4">
                        <use href="/icons/icons.svg#rotate"></use>
                      </svg>
                      Change
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- Add Deposit Modal -->
            <template x-if="$store.edit.editMode === 'editOverwrite'">
              <div class="flex justify-center">
                <button
                  @click="$store.edit.modDepo = !$store.edit.modDepo; if ($store.edit.modDepo) $nextTick(() => $refs.depoInput.focus())"
                  x-ref="depoAnchor"
                  class="modal-btn-prim !text-xs">
                  <svg class="size-4">
                    <use href="/icons/icons.svg#cash-bill"></use>
                  </svg>
                  Deposit
                </button>
                <div
                  x-show="$store.edit.modDepo"
                  @keyup.escape="$store.edit.modDepo = false"
                  @mouseenter="$store.edit.showXDepo = true"
                  @mouseleave="$store.edit.showXDepo = false"
                  x-transition.duration.300
                  x-anchor.top-start.offset.10="$refs.depoAnchor"
                  class="mr-2">
                  <div class="z-20 p-4 bg-white border-vls/40 border dark:bg-vdp2 text-vls3 rounded shadow-lg max-w-48">
                    <div class="relative">
                      <button
                        x-show="$store.edit.showXDepo"
                        @click="$store.edit.modDepo = false"
                        x-transition.duration.300
                        class="absolute !-top-3 !-right-3 table-interaction-icon-red">
                        <svg class="size-4">
                          <use href="/icons/icons.svg#xmark-circle"></use>
                        </svg>
                      </button>
                    </div>
                    <h3 class="mb-2 modal-title !text-lg !text-center">Deposit</h3>
                    <div class="relative mb-3">
                      <input
                        :id="'deposit-input-edit'"
                        x-ref="depoInput"
                        type="number"
                        x-model.number="$store.edit.uiDeposit"
                        @input="
                          $store.edit.uiDeposit = parseFloat(String($store.edit.uiDeposit).slice(0, 6)) || 0;
                        "
                        class="modal-input-style !p-1 max-w-36 flex place-self-center" />
                      <span
                        class="absolute right-2 top-1/2 transform -translate-y-1/2 text-base text-vls2/70 dark:text-vds/70 mr-2">
                        <span x-text="$store.edit.invoiceItems.invoice.deposit_type === 1 ? '%' : '£'"></span>
                      </span>
                    </div>
                    <div class="flex justify-between gap-x-4">
                      <button
                        @click="$store.edit.addDeposit(); $nextTick(() => $refs.depoInput.focus());"
                        class="modal-btn-prim !place-self-center !text-xs">
                        <svg class="size-4">
                          <use href="/icons/icons.svg#check-circle"></use>
                        </svg>
                        Apply
                      </button>
                      <button
                        @click="$store.edit.changeDepositType(); $nextTick(() => $refs.depoInput.focus());"
                        class="modal-btn-prim !place-self-center !text-xs">
                        <svg class="size-4">
                          <use href="/icons/icons.svg#rotate"></use>
                        </svg>
                        Change
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </template>
            <!-- Note Modal -->
            <div
              x-data="{
                  modNote: false, 
                  uiNote: '',
                  showX: false,
                  addNote() {
                    if ($store.edit.invoiceItems.invoice.note.length !== 0) {
                      
                      callWarning('Note already exists', 'Remove existing note and try again')
                      return  
                    }
                    $store.edit.invoiceItems.invoice.note = ''
                    $store.edit.invoiceItems.invoice.note = this.uiNote
                    this.uiNote = ''
                  }
                }"
              class="flex justify-center">
              <button
                @click="modNote = !modNote; if (modNote) $nextTick(() => $refs.noteInput.focus())"
                x-ref="noteAnchor"
                class="modal-btn-prim !text-xs">
                <svg class="size-4">
                  <use href="/icons/icons.svg#clipboard"></use>
                </svg>
                Note
              </button>
              <!-- Note Modal -->
              <div
                x-show="modNote"
                @keyup.escape="modNote = false"
                @mouseenter="showX = true"
                @mouseleave="showX = false"
                x-transition.duration.300
                x-anchor.top-start.offset.10="$refs.noteAnchor"
                style="display: none; position: absolute">
                <div
                  class="z-30 p-2 bg-white border-vls/40 border dark:bg-vdp2 text-vls3 rounded shadow-lg w-60 flex flex-col relative">
                  <!-- Close Button -->
                  <div class="relative flex justify-end">
                    <button
                      x-show="showX"
                      @click="modNote = false"
                      x-transition.duration.300
                      class="absolute !-top-2 !-right-2 table-interaction-icon-red">
                      <svg class="size-4">
                        <use href="/icons/icons.svg#xmark-circle"></use>
                      </svg>
                    </button>
                  </div>
                  <!-- Scrollable Fixed-Height Textbox -->
                  <textarea
                    :id="'note-input-edit'"
                    x-ref="noteInput"
                    x-model="uiNote"
                    placeholder="Enter note..."
                    maxlength="220"
                    class="modal-input-style text-sm p-2 h-28 pt-2 w-full resize-none overflow-y-auto"></textarea>

                  <div class="relative flex justify-end mt-2">
                    <button
                      @click="addNote(); $nextTick(() => $refs.noteInput.focus())"
                      class="modal-btn-prim !p-1 !text-xs">
                      <svg class="size-4">
                        <use href="/icons/icons.svg#check-circle"></use>
                      </svg>
                      Accept
                    </button>
                  </div>
                </div>
              </div>
              <!-- View-Note Modal -->
              <template x-if="$store.edit.editMode === 'editCopy'">
                <div
                  x-data="{ 
                  viewNote: false,
                }"
                  class="flex justify-center ml-2">
                  <button
                    @click="
                      if (!$store.edit.invoiceItems.invoice.note || $store.edit.invoiceItems.invoice.note.length === 0) {
                        callWarning('No note for this invoice');
                      } else {
                        viewNote = true;
                      }
                    "
                    class="modal-btn-prim !text-xs">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#clipboard"></use>
                    </svg>
                  </button>
                  <!-- Modal -->
                  <div
                    x-show="viewNote"
                    x-transition.opacity.duration.300
                    class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
                    <div
                      class="p-4 bg-white dark:bg-vdp2 text-vls3 dark:text-vds rounded shadow-lg w-80 flex flex-col relative">
                      <!-- Close Button -->
                      <div class="relative flex justify-end">
                        <button
                          @click="viewNote = false"
                          x-transition.duration.300
                          class="absolute !-top-2 !-right-2 table-interaction-icon-red">
                          <svg class="size-4">
                            <use href="/icons/icons.svg#xmark-circle"></use>
                          </svg>
                        </button>
                      </div>
                      <h3 class="text-lg font-semibold text-center mb-2">Invoice Note</h3>
                      <!-- Note Content -->
                      <div
                        class="overflow-y-auto max-h-40 p-2 border rounded border-vls/40 dark:border-vds3light bg-vlp dark:bg-vdp3">
                        <p class="text-sm break-words" x-text="$store.edit.invoiceItems.invoice.note"></p>
                      </div>
                      <button
                        x-show="$store.edit.invoiceItems.invoice.note.length !== 0"
                        @click="$store.edit.invoiceItems.invoice.note = ''; viewNote = false"
                        class="self-start justify-self-start flex mt-0.5 text-xs text-red-600 hover:underline">
                        Remove Note
                      </button>
                    </div>
                  </div>
                </div>
              </template>
            </div>

            <template x-if="$store.edit.editMode === 'editCopy'">
              <div class="flex justify-center">
                <button
                  @click="$store.edit.modDepo = !$store.edit.modDepo; if ($store.edit.modDepo) $nextTick(() => $refs.depoInput.focus())"
                  x-ref="depoAnchor"
                  class="modal-btn-prim !text-xs">
                  <svg class="size-4">
                    <use href="/icons/icons.svg#cash-bill"></use>
                  </svg>
                  Deposit
                </button>
                <div
                  x-show="$store.edit.modDepo"
                  @keyup.escape="$store.edit.modDepo = false"
                  @mouseenter="$store.edit.showXDepo = true"
                  @mouseleave="$store.edit.showXDepo = false"
                  x-transition.duration.300
                  x-anchor.top-start.offset.10="$refs.depoAnchor"
                  class="mr-2">
                  <div class="z-20 p-4 bg-white border-vls/40 border dark:bg-vdp2 text-vls3 rounded shadow-lg max-w-48">
                    <div class="relative">
                      <button
                        x-show="$store.edit.showXDepo"
                        @click="$store.edit.modDepo = false"
                        x-transition.duration.300
                        class="absolute !-top-3 !-right-3 table-interaction-icon-red">
                        <svg class="size-4">
                          <use href="/icons/icons.svg#xmark-circle"></use>
                        </svg>
                      </button>
                    </div>
                    <h3 class="mb-2 modal-title !text-lg !text-center">Deposit</h3>
                    <div class="relative mb-3">
                      <input
                        :id="'deposit-input-edit'"
                        x-ref="depoInput"
                        type="number"
                        x-model.number="$store.edit.uiDeposit"
                        @input="
                          $store.edit.uiDeposit = parseFloat(String($store.edit.uiDeposit).slice(0, 6)) || 0;
                        "
                        class="modal-input-style !p-1 max-w-36 flex place-self-center" />
                      <span
                        class="absolute right-2 top-1/2 transform -translate-y-1/2 text-base text-vls2/70 dark:text-vds/70 mr-2">
                        <span x-text="$store.edit.invoiceItems.invoice.deposit_type === 1 ? '%' : '£'"></span>
                      </span>
                    </div>
                    <div class="flex justify-between gap-x-4">
                      <button
                        @click="$store.edit.addDeposit(); $nextTick(() => $refs.depoInput.focus());"
                        class="modal-btn-prim !place-self-center !text-xs">
                        <svg class="size-4">
                          <use href="/icons/icons.svg#check-circle"></use>
                        </svg>
                        Apply
                      </button>
                      <button
                        @click="$store.edit.changeDepositType(); $nextTick(() => $refs.depoInput.focus());"
                        class="modal-btn-prim !place-self-center !text-xs">
                        <svg class="size-4">
                          <use href="/icons/icons.svg#rotate"></use>
                        </svg>
                        Change
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </template>

            <!-- Add Item Button -->
            <template x-if="$store.edit.editMode === 'editOverwrite'">
              <button
                @click="$store.edit.existingItems.showItemModal = true"
                class="modal-btn-prim flex items-center justify-center !text-xs">
                <svg class="size-4">
                  <use href="/icons/icons.svg#items"></use>
                </svg>
                Add Item
              </button>
            </template>
          </div>
        </div>
      </div>
      <div class="flex w-full justify-between mt-2">
        <button @click="$store.edit.cancelEdit()" class="modal-btn-prim flex items-center !p-1 !text-sm">
          <svg class="size-4">
            <use href="/icons/icons.svg#xmark-circle"></use>
          </svg>
          Cancel
        </button>
        <!-- Save edit -->
        <button @click="$store.edit.saveEdit()" class="modal-btn-prim flex items-center !p-1 !text-sm">
          <svg class="size-4">
            <use href="/icons/icons.svg#check-circle"></use>
          </svg>
          Save Invoice
        </button>
      </div>
    </div>
  </template>

  <!-- “Choose Edit Type” Modal -->
  <div
    x-show="$store.edit.openEditModal"
    x-transition.opacity.duration.300
    class="fixed inset-0 z-[99] flex items-center justify-center bg-black bg-opacity-50">
    <div class="relative p-6 bg-white rounded-lg shadow-lg w-80 dark:bg-vdp modal-bg-and-borders">
      <div class="text-center">
        <h2 class="text-xl font-medium mb-2 text-vls2 dark:text-vds">Choose Edit Type</h2>
        <p class="mb-4 text-sm font-normal text-vls2 dark:text-vds">How would you like to edit this invoice?</p>
        <!-- Overwrite -->
        <label
          :class="{
            'border-vls/80 text-vls2 dark:border-vds dark:text-vds': $store.edit.editMode === 'editOverwrite',
            'border-vls/40 text-vls2/60 dark:border-vds/40 dark:text-vds/60': $store.edit.editMode !== 'editOverwrite'
          }"
          class="mb-4 border rounded-md flex items-center justify-between p-2 font-medium hover:border-vls/80 hover:text-vls2 dark:hover:border-vds dark:hover:text-vds transition">
          <div class="flex items-center">
            <input
              type="radio"
              value="editOverwrite"
              x-model="$store.edit.editMode"
              class="mr-6 ml-2 text-lg text-vlp dark:text-vds" />
            <span>Edit - Fix issues</span>
          </div>
          <div class="flex items-center ml-auto">
            <div
              x-data="tooltip('Edit and overwrite invoice.\n Use this to correct mistakes.\n (Replaces old invoice.)')"
              class="inline-flex items-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-5">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
              </svg>
            </div>
          </div>
        </label>

        <!-- Copy -->
        <label
          :class="{
            'border-vls/80 text-vls2 dark:border-vds dark:text-vds': $store.edit.editMode === 'editCopy',
            'border-vls/40 text-vls2/60 dark:border-vds/40 dark:text-vds/60': $store.edit.editMode !== 'editCopy'
          }"
          class="mb-4 border rounded-md flex items-center justify-between p-2 font-medium hover:border-vls/80 hover:text-vls2 dark:hover:border-vds dark:hover:text-vds transition">
          <div class="flex items-center">
            <input
              type="radio"
              value="editCopy"
              x-model="$store.edit.editMode"
              class="mr-6 ml-2 text-lg text-vlp dark:text-vds" />
            <span>Copy - Pay Deposits</span>
          </div>
          <div class="flex items-center ml-auto">
            <div
              x-data="tooltip('Invoice clients when they pay deposit.\n Creates new invoice with related number \n(e.g. SAM-1 → SAM-1.1).')"
              class="inline-flex items-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-5">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
              </svg>
            </div>
          </div>
        </label>

        <div class="flex justify-between w-full">
          <!-- Confirm/Close -->
          <button
            @click="$store.edit.openEditModal = false; $store.edit.editMode = ''"
            class="modal-btn-sec flex place-self-center">
            Close
          </button>
          <button
            @click="$store.edit.editInvoice()"
            class="modal-btn-sec !bg-vls2 dark:!bg-vla2 hover:brightness-110 !px-2 flex place-self-center">
            Edit
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- “Add Existing Item” Modal -->
  <div
    x-show="$store.edit.existingItems.showItemModal"
    x-transition.opacity.duration.300ms
    class="fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-50">
    <div class="w-full max-w-2xl mx-4 bg-vlp dark:bg-zinc-900 border border-vls/40 rounded shadow-lg">
      <!-- Modal Header -->
      <div class="px-6 py-4 border-b border-vls/40">
        <h3
          class="text-xl font-medium text-center text-vls2 dark:text-vds"
          x-text="`${$store.clients.selectedClient?.name || ''}’s Items`"></h3>
        <p class="mt-2 text-sm text-center text-vls2 dark:text-vds">Add from existing styles and samples</p>
      </div>
      <!-- Modal Body -->
      <div class="px-6 py-4 max-h-96 flex flex-col">
        <!-- Existing Items Dropdown -->
        <div class="relative mb-6">
          <button
            x-ref="existingItemsDropdown"
            @click="$store.edit.existingItems.openDropdown = !$store.edit.existingItems.openDropdown; $store.edit.fetchStylesAndSamples($store.clients.selectedClient?.id)"
            class="w-full flex items-center justify-between px-4 py-2 border shadow-sm border-vls/40 rounded hover:border-vls hover:text-vls2 transition focus:outline-none dark:border-vlp/40 dark:hover:border-vds dark:text-vlp/40 dark:hover:text-vds">
            <span class="text-vls2 dark:text-vds">Existing Items</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-6">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M8.25 15 12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
            </svg>
          </button>
          <!-- Scrollable Table Container -->
          <div
            x-show="$store.edit.existingItems.openDropdown"
            x-collapse.duration.500ms
            class="absolute z-40 mt-2 w-full max-h-80 overflow-hidden rounded border border-vls/40 bg-vlp dark:bg-vdp2 shadow-lg">
            <!-- Table Wrapper with Scroll -->
            <div class="max-h-80 overflow-y-auto">
              <table class="w-full text-vls2 dark:text-vds">
                <!-- Sticky Header -->
                <thead class="sticky top-0 bg-vlp dark:bg-vdp shadow z-10">
                  <tr>
                    <th colspan="6" class="p-2">
                      <input
                        id="search-items-dropdown"
                        type="text"
                        placeholder="Search items..."
                        class="!w-full px-2 py-1 srch-style"
                        x-model="$store.edit.existingItems.searchQuery" />
                    </th>
                  </tr>
                  <tr class="text-sm bg-vlp dark:bg-vdp">
                    <th class="pl-2 py-2 text-left w-[40%]">Name</th>
                    <th class="p-2 text-right w-[15%]">Price</th>
                    <th class="p-2 text-right w-[15%]">Time</th>
                    <th class="p-2 text-right w-[10%]">Type</th>
                    <th class="p-2 text-center w-[10%]">Qty</th>
                    <th class="p-2 text-center w-[10%]">Actions</th>
                  </tr>
                </thead>

                <!-- Scrollable Table Body -->
                <tbody>
                  <template
                    x-for="item in $store.edit.existingItems.filteredItems"
                    :key="`dropdown-${item.type}-${item.id}`">
                    <tr class="cursor-pointer hover:bg-vlp2 dark:hover:bg-vdp3">
                      <td class="pl-2 py-2 text-sm" x-text="item.name"></td>
                      <td class="p-2 text-sm text-right" x-text="item.price"></td>
                      <td class="p-2 text-sm text-right" x-text="item.type === 'sample' ? item.time : 'N/A'"></td>
                      <td class="p-2 text-sm text-right" x-text="item.type"></td>
                      <td class="p-2 text-sm text-center">
                        <input
                          :id="'input-id-' + `dropdown-${item.type}-${item.id}`"
                          type="number"
                          min="1"
                          x-model.number="item.quantity"
                          class="table-edit-input-style max-w-12 text-center" />
                      </td>
                      <td class="p-2 text-center">
                        <button @click="$store.edit.addDropdownItem(item)" class="table-interaction-icon-blue">
                          <svg class="size-5" fill="currentColor">
                            <use href="/icons/icons.svg#plus-circle" />
                          </svg>
                        </button>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- CUSTOM NEW Item Type Selection -->
        <div class="flex justify-center space-x-8 mb-6">
          <label class="flex items-center space-x-4 cursor-pointer">
            <input type="radio" x-model="$store.edit.newItem.type" value="style" class="form-radio text-vlp" />
            <span class="text-vls2 dark:text-vds">Style</span>
          </label>
          <label class="flex items-center space-x-4 cursor-pointer">
            <input type="radio" x-model="$store.edit.newItem.type" value="sample" class="form-radio text-vlp" />
            <span class="text-vls2 dark:text-vds">Sample</span>
          </label>
        </div>
        <!-- New Item Form - Style -->
        <div
          x-show="$store.edit.newItem.type === 'style'"
          x-collapse.duration.300ms
          class="space-y-4 mb-6 flex flex-col">
          <input
            :id="'style-edit-name-input'"
            x-model="$store.edit.newItem.name"
            @input="$store.edit.newItem.name = $store.edit.newItem.name.substring(0, 80)"
            type="text"
            required
            placeholder="Style Name"
            class="p-2 bg-vlp border rounded focus:outline-none border-vls/40 focus:border-vls hover:border-vls shadow-sm dark:bg-vdp2 dark:focus:bg-vdp3 text-vls2 dark:text-vds placeholder:text-vls/60 hover:placeholder:text-vls dark:placeholder:text-vds/60" />

          <input
            :id="'style-edit-price-input'"
            x-model.number="$store.edit.newItem.price"
            type="number"
            step="0.01"
            required
            placeholder="Price"
            class="p-2 bg-vlp border rounded focus:outline-none border-vls/40 focus:border-vls hover:border-vls shadow-sm dark:bg-vdp2 dark:focus:bg-vdp3 text-vls2 dark:text-vds placeholder:text-vls/60 hover:placeholder:text-vls dark:placeholder:text-vds/60"
            @blur="$store.edit.newItem.price = Alpine.store('price').roundToTwo($store.edit.newItem.price)" />

          <input
            :id="'style-edit-quantity-input'"
            x-model.lazy="$store.edit.newItem.quantity"
            type="number"
            min="1"
            step="1"
            required
            placeholder="Quantity"
            class="p-2 bg-vlp border rounded focus:outline-none border-vls/40 focus:border-vls hover:border-vls shadow-sm dark:bg-vdp2 dark:focus:bg-vdp3 text-vls2 dark:text-vds placeholder:text-vls/60 hover:placeholder:text-vls dark:placeholder:text-vds/60"
            @input="$store.edit.newItem.quantity = Math.max(1, Math.floor($event.target.value))" />
        </div>

        <!-- New Item Form - Sample -->
        <div
          x-show="$store.edit.newItem.type === 'sample'"
          x-collapse.duration.300ms
          class="space-y-4 mb-6 flex flex-col">
          <input
            :id="'sample-edit-name-input'"
            x-model="$store.edit.newItem.name"
            @input="$store.edit.newItem.name = $store.edit.newItem.name.substring(0, 80)"
            type="text"
            required
            placeholder="Sample Name"
            class="p-2 bg-vlp border rounded focus:outline-none border-vls/40 focus:border-vls hover:border-vls shadow-sm dark:bg-vdp2 dark:focus:bg-vdp3 text-vls2 dark:text-vds placeholder:text-vls/60 hover:placeholder:text-vls dark:placeholder:text-vds/60" />

          <input
            :id="'sample-edit-price-input'"
            x-model.number="$store.edit.newItem.price"
            type="number"
            step="0.01"
            required
            placeholder="Price"
            class="p-2 bg-vlp border rounded focus:outline-none border-vls/40 focus:border-vls hover:border-vls shadow-sm dark:bg-vdp2 dark:focus:bg-vdp3 text-vls2 dark:text-vds placeholder:text-vls/60 hover:placeholder:text-vls dark:placeholder:text-vds/60"
            @blur="$store.edit.newItem.price = Alpine.store('price').roundToTwo($store.edit.newItem.price)" />

          <input
            :id="'sample-edit-time-input'"
            x-model.number="$store.edit.newItem.time"
            type="number"
            step="0.01"
            required
            placeholder="Time (minutes)"
            class="p-2 bg-vlp border rounded focus:outline-none border-vls/40 focus:border-vls hover:border-vls shadow-sm dark:bg-vdp2 dark:focus:bg-vdp3 text-vls2 dark:text-vds placeholder:text-vls/60 hover:placeholder:text-vls dark:placeholder:text-vds/60"
            @blur="$store.edit.newItem.time = Alpine.store('price').roundToTwo($store.edit.newItem.time)" />

          <input
            :id="'sample-edit-quantity-input'"
            x-model.lazy="$store.edit.newItem.quantity"
            type="number"
            min="1"
            step="1"
            required
            placeholder="Quantity"
            class="p-2 bg-vlp border rounded focus:outline-none border-vls/40 focus:border-vls hover:border-vls shadow-sm dark:bg-vdp2 dark:focus:bg-vdp3 text-vls2 dark:text-vds placeholder:text-vls/60 hover:placeholder:text-vls dark:placeholder:text-vds/60"
            @input="$store.edit.newItem.quantity = Math.max(1, Math.floor($event.target.value))" />
        </div>
      </div>
      <!-- Modal Footer -->
      <div class="flex justify-end px-6 py-4 border-t border-vls/40">
        <button
          @click="$store.edit.addCustomItem()"
          class="modal-btn-sec !bg-vls2 dark:!bg-vla2 hover:brightness-110 !px-2 flex place-self-center">
          Add
        </button>
        <button @click="$store.edit.existingItems.showItemModal = false" class="ml-4 modal-btn-sec">Close</button>
      </div>
    </div>
  </div>
</div>
